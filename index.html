<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parkinson's Speech Analysis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            width: 90%;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4c63d2 0%, #5a67d8 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .content {
            padding: 2rem;
        }

        .reading-text {
            background: #f7fafc;
            border-left: 4px solid #4c63d2;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
            font-size: 1.1rem;
            line-height: 1.6;
            color: #2d3748;
        }

        .instructions {
            background: #e6fffa;
            border: 1px solid #81e6d9;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
        }

        .instructions h3 {
            color: #065f46;
            margin-bottom: 0.5rem;
        }

        .instructions ul {
            margin-left: 1.5rem;
            color: #047857;
        }

        .instructions li {
            margin-bottom: 0.5rem;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin: 2rem 0;
        }

        .record-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            padding: 2rem;
            background: #f7fafc;
            border-radius: 10px;
            border: 2px dashed #cbd5e0;
        }

        .record-button {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: none;
            background: #e53e3e;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .record-button:hover {
            transform: scale(1.1);
        }

        .record-button.recording {
            background: #38a169;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .file-upload {
            margin: 1rem 0;
        }

        .file-input {
            display: none;
        }

        .file-label {
            display: inline-block;
            padding: 12px 24px;
            background: #4c63d2;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .file-label:hover {
            background: #3c50c7;
        }

        .analyze-button {
            background: #38a169;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .analyze-button:hover {
            background: #2f855a;
        }

        .analyze-button:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4c63d2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results {
            display: none;
            margin-top: 2rem;
            padding: 2rem;
            border-radius: 10px;
        }

        .results.positive {
            background: #fed7d7;
            border: 1px solid #fc8181;
        }

        .results.negative {
            background: #c6f6d5;
            border: 1px solid #68d391;
        }

        .results h3 {
            margin-bottom: 1rem;
        }

        .confidence {
            font-weight: bold;
            margin: 0.5rem 0;
        }

        .disclaimer {
            background: #fef5e7;
            border: 1px solid #f6ad55;
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 2rem;
        }

        .disclaimer h4 {
            color: #c05621;
            margin-bottom: 0.5rem;
        }

        .disclaimer p {
            color: #744210;
            font-size: 0.9rem;
        }

        @media (max-width: 600px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .content {
                padding: 1rem;
            }
            
            .reading-text {
                padding: 1rem;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Parkinson's Speech Analysis</h1>
            <p>AI-powered speech analysis for early detection screening</p>
        </div>
        
        <div class="content">
            <div class="instructions">
                <h3>Instructions:</h3>
                <ul>
                    <li>Read the text below clearly and naturally</li>
                    <li>Record your voice using the record button or upload an audio file</li>
                    <li>The AI will analyze speech patterns for potential Parkinson's indicators</li>
                    <li>Results are for screening purposes only - consult healthcare professionals for diagnosis</li>
                </ul>
            </div>

            <div class="reading-text" id="readingText">
                Loading text...
            </div>

            <div class="controls">
                <div class="record-section">
                    <h3>Record Your Voice</h3>
                    <button class="record-button" id="recordButton" title="Click to start recording">
                        üé§
                    </button>
                    <p id="recordStatus">Click the microphone to start recording</p>
                    <audio id="audioPlayback" controls style="display: none;"></audio>
                </div>

                <div class="file-upload">
                    <label for="audioFile" class="file-label">
                        üìÅ Or Upload Audio File
                    </label>
                    <input type="file" id="audioFile" class="file-input" accept="audio/*">
                    <span id="fileName" style="margin-left: 1rem; color: #666;"></span>
                </div>

                <button class="analyze-button" id="analyzeButton" disabled>
                    Analyze Speech
                </button>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Analyzing your speech patterns...</p>
            </div>

            <div class="results" id="results">
                <h3 id="resultTitle"></h3>
                <div class="confidence" id="confidence"></div>
                <p id="resultMessage"></p>
            </div>

            <div class="disclaimer">
                <h4>Important Disclaimer</h4>
                <p>
                    This tool is for educational and screening purposes only. It cannot replace professional 
                    medical diagnosis. If you have concerns about Parkinson's disease or other neurological 
                    conditions, please consult with qualified healthcare professionals for proper evaluation 
                    and diagnosis.
                </p>
            </div>
        </div>
    </div>

    <script>
        class ParkinsonsAnalyzer {
            constructor() {
                this.mediaRecorder = null;
                this.audioChunks = [];
                this.isRecording = false;
                this.recordedAudio = null;
                this.uploadedFile = null;

                this.initializeElements();
                this.setupEventListeners();
                this.loadReadingText();
            }

            initializeElements() {
                this.recordButton = document.getElementById('recordButton');
                this.recordStatus = document.getElementById('recordStatus');
                this.audioPlayback = document.getElementById('audioPlayback');
                this.fileInput = document.getElementById('audioFile');
                this.fileName = document.getElementById('fileName');
                this.analyzeButton = document.getElementById('analyzeButton');
                this.loading = document.getElementById('loading');
                this.results = document.getElementById('results');
                this.readingText = document.getElementById('readingText');
            }

            setupEventListeners() {
                this.recordButton.addEventListener('click', () => this.toggleRecording());
                this.fileInput.addEventListener('change', (e) => this.handleFileUpload(e));
                this.analyzeButton.addEventListener('click', () => this.analyzeAudio());
            }

            async loadReadingText() {
                try {
                    const response = await fetch('/api/text');
                    const data = await response.json();
                    this.readingText.textContent = data.text;
                } catch (error) {
                    console.error('Error loading text:', error);
                    this.readingText.textContent = "The North Wind and the Sun were disputing which was the stronger, when a traveler came along wrapped in a warm cloak. They agreed that the one who first succeeded in making the traveler take his cloak off should be considered stronger than the other. Then the North Wind blew as hard as he could, but the more he blew the more closely did the traveler fold his cloak around him; and at last the North Wind gave up the attempt. Then the Sun shone out warmly, and immediately the traveler took off his cloak. And so the North Wind was obliged to confess that the Sun was the stronger of the two.";
                }
            }

            async toggleRecording() {
                if (!this.isRecording) {
                    await this.startRecording();
                } else {
                    this.stopRecording();
                }
            }

            async startRecording() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    this.mediaRecorder = new MediaRecorder(stream);
                    this.audioChunks = [];

                    this.mediaRecorder.ondataavailable = (event) => {
                        this.audioChunks.push(event.data);
                    };

                    this.mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(this.audioChunks, { type: 'audio/wav' });
                        const audioUrl = URL.createObjectURL(audioBlob);
                        
                        this.audioPlayback.src = audioUrl;
                        this.audioPlayback.style.display = 'block';
                        this.recordedAudio = audioBlob;
                        this.analyzeButton.disabled = false;

                        // Stop all tracks to release the microphone
                        stream.getTracks().forEach(track => track.stop());
                    };

                    this.mediaRecorder.start();
                    this.isRecording = true;
                    this.recordButton.classList.add('recording');
                    this.recordButton.innerHTML = '‚èπ';
                    this.recordStatus.textContent = 'Recording... Click to stop';

                } catch (error) {
                    console.error('Error accessing microphone:', error);
                    alert('Could not access microphone. Please check permissions.');
                }
            }

            stopRecording() {
                if (this.mediaRecorder && this.isRecording) {
                    this.mediaRecorder.stop();
                    this.isRecording = false;
                    this.recordButton.classList.remove('recording');
                    this.recordButton.innerHTML = 'üé§';
                    this.recordStatus.textContent = 'Recording complete. You can play it back or analyze it.';
                }
            }

            handleFileUpload(event) {
                const file = event.target.files[0];
                if (file) {
                    this.uploadedFile = file;
                    this.fileName.textContent = file.name;
                    this.analyzeButton.disabled = false;

                    // Create audio preview
                    const audioUrl = URL.createObjectURL(file);
                    this.audioPlayback.src = audioUrl;
                    this.audioPlayback.style.display = 'block';
                }
            }

            async analyzeAudio() {
                const audioToAnalyze = this.recordedAudio || this.uploadedFile;
                
                if (!audioToAnalyze) {
                    alert('Please record or upload an audio file first.');
                    return;
                }

                this.showLoading(true);
                this.hideResults();

                try {
                    const formData = new FormData();
                    formData.append('audio', audioToAnalyze, 'audio.wav');

                    const response = await fetch('/api/analyze-audio', {
                        method: 'POST',
                        body: formData
                    });

                    const result = await response.json();

                    if (result.success) {
                        this.showResults(result.interpretation);
                    } else {
                        throw new Error(result.error || 'Analysis failed');
                    }

                } catch (error) {
                    console.error('Analysis error:', error);
                    alert('Error analyzing audio: ' + error.message);
                } finally {
                    this.showLoading(false);
                }
            }

            showLoading(show) {
                this.loading.style.display = show ? 'block' : 'none';
                this.analyzeButton.disabled = show;
            }

            hideResults() {
                this.results.style.display = 'none';
            }

            showResults(interpretation) {
                const { hasParkinson, confidence, message } = interpretation;
                
                this.results.className = hasParkinson ? 'results positive' : 'results negative';
                
                document.getElementById('resultTitle').textContent = 
                    hasParkinson ? 'Potential Indicators Detected' : 'No Significant Indicators';
                
                document.getElementById('confidence').textContent = 
                    'Confidence: ${(confidence * 100).toFixed(1)}%';
                
                document.getElementById('resultMessage').textContent = message;
                
                this.results.style.display = 'block';
                
                // Scroll to results
                this.results.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            new ParkinsonsAnalyzer();
        });
    </script>
</body>
</html>